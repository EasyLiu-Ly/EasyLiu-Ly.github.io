<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">

    

    
    <title>MVI架构实践 | EasyLiu</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="Android">
    
    <meta name="description" content="MVI架构实践">
<meta name="keywords" content="Android">
<meta property="og:type" content="article">
<meta property="og:title" content="MVI架构实践">
<meta property="og:url" content="http://easyliu.com/2023/08/13/android_architecture/mvi/index.html">
<meta property="og:site_name" content="EasyLiu">
<meta property="og:description" content="MVI架构实践">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://easyliu.com/2023/08/13/android_architecture/mvi/counter.png">
<meta property="og:updated_time" content="2023-08-13T03:46:35.504Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MVI架构实践">
<meta name="twitter:description" content="MVI架构实践">
<meta name="twitter:image" content="http://easyliu.com/2023/08/13/android_architecture/mvi/counter.png">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.5.0/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>
</html>
<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">welcome to easyliu&#39;s blog</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">主页</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Android性能优化/">Android性能优化</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Android架构学习/">Android架构学习</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Android源码解析/">Android源码解析</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Android疑难杂症/">Android疑难杂症</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Android自定义控件/">Android自定义控件</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Gradle相关/">Gradle相关</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Kotlin/">Kotlin</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/ios开发/">ios开发</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/从0打造音视频直播系统/">从0打造音视频直播系统</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/代码规范/">代码规范</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/刷题/">刷题</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/单元测试/">单元测试</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/周末活动/">周末活动</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/园艺/">园艺</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/学习计划/">学习计划</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/开发工具/">开发工具</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/旅游/">旅游</a></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">关于</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Android架构学习/">Android架构学习</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-android_architecture/mvi" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        MVI架构实践
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
      <a href="/2023/08/13/android_architecture/mvi/" class="article-date">
         <time datetime="2023-08-13T02:55:35.000Z" itemprop="datePublished">2023-08-13</time>
      </a>
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Android/">Android</a>
    </div>

                
   <span id="/2023/08/13/android_architecture/mvi/" class="leancloud-visitors" data-flag-title="MVI架构实践">
   <i class="fa fa-eye"></i>
   <span class="post-meta-item-text">阅读次数: </span>
   <i class="leancloud-visitors-count">0</i>
   </span>


                
   <div class="article-counter">
      <i class="fa fa-file-word-o"></i>
      <span class="post-count-item-text">本文字数: </span>
      <span class="post-count">1.9k</span>
      <i class="fa fa-clock-o"></i>
      <span class="post-time-item-text">阅读时长: </span>
      <span class="post-count">10 分钟 </span>
   </div>


            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <h2 id="1、为啥要用MVI架构"><a href="#1、为啥要用MVI架构" class="headerlink" title="1、为啥要用MVI架构"></a>1、为啥要用MVI架构</h2><p>为啥要从MVVM过渡到MVI，结合实际开发经验，个人总结以下几点：</p>
<blockquote>
<p>1、从MVVM中的多个LiveData挨个观察改为一个State统一观察，当然如果我们需要观察State里面单独的某个字段，这个也是很方便做到的，下面的代码会讲到<br>2、之前MVVM架构中，VM会开放很多方法给View调用；在MVI架构中，只有一个SendIntent入口，因此在一开始我们就可以把所有支持的的Intent全部定义出来，这样看起来就一目了然，知道当前VM支持哪些Intent，而不用去看VM的具体实现细节<br>3、有了State和Intent之后，就相当于明确了VM的输出和输入，符合单向数据流的思想，方便封装和解耦，且非常方便写单元测试；并且这个State和Intent相当于是一个约定，这样就可以做到一个人写逻辑，一个人写UI，互不干扰，因为大家都是遵循这个约定来写，提升研发效率</p>
</blockquote>
<h2 id="2、State"><a href="#2、State" class="headerlink" title="2、State"></a>2、State</h2><p>State接口定义：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MviUiState</span></span></span><br></pre></td></tr></table></figure>

<h2 id="3、Intent"><a href="#3、Intent" class="headerlink" title="3、Intent"></a>3、Intent</h2><p>Intent接口定义:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MviUiIntent</span></span></span><br></pre></td></tr></table></figure>

<h2 id="4、BaseMviViewModel"><a href="#4、BaseMviViewModel" class="headerlink" title="4、BaseMviViewModel"></a>4、BaseMviViewModel</h2><p>1、State使用StateFlow来承载，类似于LiveData<br>2、Intent使用MutableShareFlow来承载，因为默认ShareFlow的replay = 0（一次性的，非粘性回调），符合Intent的思想（当然这里不使用Flow直接调用handleIntent方法也是可以的）<br>3、子类覆写handleIntent方法来实现具体的Intent逻辑<br>4、子类通过调用updateState来更新State<br>5、构造VM的时候必须传入一个initState</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseMviViewModel</span>&lt;<span class="type">S : MviUiState, I : MviUiIntent</span>&gt;</span>(initialState: S) :</span><br><span class="line">    ViewModel() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> mutableStateFlow = MutableStateFlow(initialState)</span><br><span class="line">    <span class="keyword">val</span> uiStateFlow = mutableStateFlow.asStateFlow()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> uiIntentFlow = MutableSharedFlow&lt;I&gt;()</span><br><span class="line">    <span class="keyword">var</span> state = initialState</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleIntent</span><span class="params">(uiIntent: <span class="type">I</span>)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        viewModelScope.launch &#123;</span><br><span class="line">            uiIntentFlow.collect &#123;</span><br><span class="line">                handleIntent(it)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateState</span><span class="params">(reducer: <span class="type">S</span>.() -&gt; <span class="type">S</span>)</span></span> &#123;</span><br><span class="line">        viewModelScope.launch &#123;</span><br><span class="line">            state = state.reducer()</span><br><span class="line">            mutableStateFlow.emit(state)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setIntent</span><span class="params">(uiIntent: <span class="type">I</span>)</span></span> &#123;</span><br><span class="line">        viewModelScope.launch &#123;</span><br><span class="line">            uiIntentFlow.emit(uiIntent)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5、MviView"><a href="#5、MviView" class="headerlink" title="5、MviView"></a>5、MviView</h2><p>实际上在UI层拿到了ViewModel之后，就可以直接监听State了:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lifecycleScope.launchWhenCreated &#123;</span><br><span class="line">    viewModel.uiStateFlow.collect &#123;</span><br><span class="line">           </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们只想监听State里面某个字段的改变，可以这样写:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lifecycleScope.launchWhenCreated &#123;</span><br><span class="line">    viewModel.uiStateFlow</span><br><span class="line">        .map &#123; CounterUiState::count.<span class="keyword">get</span>(it) &#125;</span><br><span class="line">        .distinctUntilChanged()</span><br><span class="line">        .collect &#123;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过反射以及distinctUntilChanged来达到单独监听某个字段以及进行去重处理(如果是LiveData需要自己做特殊处理)</p>
<p>可以看到，如果需要单独监听某个字段还是需要写很多模板代码的，因此我们可以抽一个MviView的接口，在里面提供监听单个或者多个字段的方法，以及提供默认的订阅协程，这个默认协程MviView实现类可以覆写:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple1</span>&lt;<span class="type">A</span>&gt;</span>(<span class="keyword">val</span> a: A)</span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple2</span>&lt;<span class="type">A, B</span>&gt;</span>(<span class="keyword">val</span> a: A, <span class="keyword">val</span> b: B)</span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple3</span>&lt;<span class="type">A, B, C</span>&gt;</span>(<span class="keyword">val</span> a: A, <span class="keyword">val</span> b: B, <span class="keyword">val</span> c: C)</span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple4</span>&lt;<span class="type">A, B, C, D</span>&gt;</span>(<span class="keyword">val</span> a: A, <span class="keyword">val</span> b: B, <span class="keyword">val</span> c: C, <span class="keyword">val</span> d: D)</span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple5</span>&lt;<span class="type">A, B, C, D, E</span>&gt;</span>(<span class="keyword">val</span> a: A, <span class="keyword">val</span> b: B, <span class="keyword">val</span> c: C, <span class="keyword">val</span> d: D, <span class="keyword">val</span> e: E)</span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple6</span>&lt;<span class="type">A, B, C, D, E, F</span>&gt;</span>(</span><br><span class="line">    <span class="keyword">val</span> a: A,</span><br><span class="line">    <span class="keyword">val</span> b: B,</span><br><span class="line">    <span class="keyword">val</span> c: C,</span><br><span class="line">    <span class="keyword">val</span> d: D,</span><br><span class="line">    <span class="keyword">val</span> e: E,</span><br><span class="line">    <span class="keyword">val</span> f: F</span><br><span class="line">)</span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple7</span>&lt;<span class="type">A, B, C, D, E, F, G</span>&gt;</span>(</span><br><span class="line">    <span class="keyword">val</span> a: A,</span><br><span class="line">    <span class="keyword">val</span> b: B,</span><br><span class="line">    <span class="keyword">val</span> c: C,</span><br><span class="line">    <span class="keyword">val</span> d: D,</span><br><span class="line">    <span class="keyword">val</span> e: E,</span><br><span class="line">    <span class="keyword">val</span> f: F,</span><br><span class="line">    <span class="keyword">val</span> g: G</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MviView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收集状态的协程，子类可以自定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> subscriptionScope: CoroutineScope?</span><br><span class="line">        <span class="keyword">get</span>() = <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">val</span> lifecycleOwner = (<span class="keyword">this</span> <span class="keyword">as</span>? Fragment)?.viewLifecycleOwner ?: <span class="keyword">this</span> <span class="keyword">as</span>? LifecycleOwner</span><br><span class="line">            lifecycleOwner?.lifecycleScope</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: IllegalStateException) &#123;</span><br><span class="line">            <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;S : MviUiState, I : MviUiIntent, T&gt;</span> BaseMviViewModel<span class="type">&lt;S, I&gt;</span>.<span class="title">onEach</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        block: (<span class="type">state</span>: <span class="type">S</span>) -&gt; <span class="type">T</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        action: <span class="type">suspend</span> (<span class="type">T</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">        uiStateFlow.map &#123; Tuple1(block(it)) &#125;.distinctUntilChanged()</span><br><span class="line">            .resolveSubscription(subscriptionScope) &#123;</span><br><span class="line">                action(it.a)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;S : MviUiState, I : MviUiIntent, T&gt;</span> BaseMviViewModel<span class="type">&lt;S, I&gt;</span>.<span class="title">onEach</span><span class="params">(prop1: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, T&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                                           action: <span class="type">suspend</span> (<span class="type">T</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">        uiStateFlow.map &#123; Tuple1(prop1.<span class="keyword">get</span>(it)) &#125;.distinctUntilChanged()</span><br><span class="line">            .resolveSubscription(subscriptionScope) &#123;</span><br><span class="line">                action(it.a)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;S : MviUiState, I : MviUiIntent, A, B&gt;</span> BaseMviViewModel<span class="type">&lt;S, I&gt;</span>.<span class="title">onEach</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        prop1: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop2: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, B&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        action: <span class="type">suspend</span> (<span class="type">A</span>, <span class="type">B</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">        uiStateFlow.map &#123; Tuple2(prop1.<span class="keyword">get</span>(it), prop2.<span class="keyword">get</span>(it)) &#125;</span><br><span class="line">            .distinctUntilChanged().resolveSubscription(subscriptionScope) &#123;</span><br><span class="line">                action(it.a, it.b)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;S : MviUiState, I : MviUiIntent, A, B, C&gt;</span> BaseMviViewModel<span class="type">&lt;S, I&gt;</span>.<span class="title">onEach</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        prop1: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop2: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, B&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop3: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, C&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        action: <span class="type">suspend</span> (<span class="type">A</span>, <span class="type">B</span>, <span class="type">C</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">        uiStateFlow.map &#123; Tuple3(prop1.<span class="keyword">get</span>(it), prop2.<span class="keyword">get</span>(it), prop3.<span class="keyword">get</span>(it)) &#125;</span><br><span class="line">            .distinctUntilChanged().resolveSubscription(subscriptionScope) &#123;</span><br><span class="line">                action(it.a, it.b, it.c)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;S : MviUiState, I : MviUiIntent, A, B, C, D&gt;</span> BaseMviViewModel<span class="type">&lt;S, I&gt;</span>.<span class="title">onEach</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        prop1: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop2: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, B&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop3: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, C&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop4: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, D&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        action: <span class="type">suspend</span> (<span class="type">A</span>, <span class="type">B</span>, <span class="type">C</span>, <span class="type">D</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">        uiStateFlow.map &#123; Tuple4(prop1.<span class="keyword">get</span>(it), prop2.<span class="keyword">get</span>(it), prop3.<span class="keyword">get</span>(it), prop4.<span class="keyword">get</span>(it)) &#125;</span><br><span class="line">            .distinctUntilChanged().resolveSubscription(subscriptionScope) &#123;</span><br><span class="line">                action(it.a, it.b, it.c, it.d)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;S : MviUiState, I : MviUiIntent, A, B, C, D, E&gt;</span> BaseMviViewModel<span class="type">&lt;S, I&gt;</span>.<span class="title">onEach</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        prop1: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop2: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, B&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop3: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, C&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop4: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, D&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop5: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, E&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        action: <span class="type">suspend</span> (<span class="type">A</span>, <span class="type">B</span>, <span class="type">C</span>, <span class="type">D</span>, <span class="type">E</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">        uiStateFlow.map &#123; Tuple5(prop1.<span class="keyword">get</span>(it), prop2.<span class="keyword">get</span>(it), prop3.<span class="keyword">get</span>(it), prop4.<span class="keyword">get</span>(it), prop5.<span class="keyword">get</span>(it)) &#125;</span><br><span class="line">            .distinctUntilChanged().resolveSubscription(subscriptionScope) &#123;</span><br><span class="line">                action(it.a, it.b, it.c, it.d, it.e)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;S : MviUiState, I : MviUiIntent, A, B, C, D, E, F&gt;</span> BaseMviViewModel<span class="type">&lt;S, I&gt;</span>.<span class="title">onEach</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        prop1: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop2: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, B&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop3: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, C&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop4: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, D&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop5: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, E&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop6: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, F&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        action: <span class="type">suspend</span> (<span class="type">A</span>, <span class="type">B</span>, <span class="type">C</span>, <span class="type">D</span>, <span class="type">E</span>, <span class="type">F</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">        uiStateFlow.map &#123;</span><br><span class="line">            Tuple6(prop1.<span class="keyword">get</span>(it),</span><br><span class="line">                prop2.<span class="keyword">get</span>(it),</span><br><span class="line">                prop3.<span class="keyword">get</span>(it),</span><br><span class="line">                prop4.<span class="keyword">get</span>(it),</span><br><span class="line">                prop5.<span class="keyword">get</span>(it),</span><br><span class="line">                prop6.<span class="keyword">get</span>(it))</span><br><span class="line">        &#125;</span><br><span class="line">            .distinctUntilChanged().resolveSubscription(subscriptionScope) &#123;</span><br><span class="line">                action(it.a, it.b, it.c, it.d, it.e, it.f)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;S : MviUiState, I : MviUiIntent, A, B, C, D, E, F, G&gt;</span> BaseMviViewModel<span class="type">&lt;S, I&gt;</span>.<span class="title">onEach</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        prop1: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop2: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, B&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop3: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, C&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop4: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, D&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop5: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, E&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop6: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, F&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        prop7: <span class="type">KProperty1</span>&lt;<span class="type">S</span>, G&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        action: <span class="type">suspend</span> (<span class="type">A</span>, <span class="type">B</span>, <span class="type">C</span>, <span class="type">D</span>, <span class="type">E</span>, <span class="type">F</span>, <span class="type">G</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">        uiStateFlow.map &#123;</span><br><span class="line">            Tuple7(prop1.<span class="keyword">get</span>(it),</span><br><span class="line">                prop2.<span class="keyword">get</span>(it),</span><br><span class="line">                prop3.<span class="keyword">get</span>(it),</span><br><span class="line">                prop4.<span class="keyword">get</span>(it),</span><br><span class="line">                prop5.<span class="keyword">get</span>(it),</span><br><span class="line">                prop6.<span class="keyword">get</span>(it),</span><br><span class="line">                prop7.<span class="keyword">get</span>(it))</span><br><span class="line">        &#125;.distinctUntilChanged().resolveSubscription(subscriptionScope) &#123;</span><br><span class="line">            action(it.a, it.b, it.c, it.d, it.e, it.f, it.g)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中resolveSubscription定义在BaseMviViewModel里面:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Flow<span class="type">&lt;T&gt;</span>.<span class="title">resolveSubscription</span><span class="params">(subscriptionScope: <span class="type">CoroutineScope</span>? = <span class="literal">null</span>, action: <span class="type">suspend</span> (<span class="type">T</span>) -&gt; <span class="type">Unit</span>)</span></span>: Job &#123;</span><br><span class="line">    <span class="keyword">return</span> (subscriptionScope <span class="keyword">as</span>? LifecycleCoroutineScope)?.launchWhenCreated &#123;</span><br><span class="line">        yield()</span><br><span class="line">        collectLatest(action)</span><br><span class="line">    &#125; ?: run &#123;</span><br><span class="line">        <span class="keyword">val</span> scope = subscriptionScope ?: viewModelScope</span><br><span class="line">        scope.launch(start = CoroutineStart.UNDISPATCHED) &#123;</span><br><span class="line">            <span class="comment">// Use yield to ensure flow collect coroutine is dispatched rather than invoked immediately.</span></span><br><span class="line">            <span class="comment">// This is necessary when Dispatchers.Main.immediate is used in scope.</span></span><br><span class="line">            <span class="comment">// Coroutine is launched with start = CoroutineStart.UNDISPATCHED to perform dispatch only once.</span></span><br><span class="line">            yield()</span><br><span class="line">            collectLatest(action)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于这些onEach方法是定义在MViView接口里面的，因此只有实现了MviView接口的UI才能调用这些onEach方法</p>
<h2 id="6、实践"><a href="#6、实践" class="headerlink" title="6、实践"></a>6、实践</h2><p>假设我们要实现如下所示的一个计数器：第一行是当前计数展示，下面俩个按钮分别是add和decrease:<br><img src="/2023/08/13/android_architecture/mvi/counter.png" alt></p>
<p>首先是定义State和Intent：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">CounterUiState</span></span>(<span class="keyword">val</span> count: <span class="built_in">Int</span> = <span class="number">0</span>) : MviUiState</span><br><span class="line"></span><br><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">CounterUiIntent</span> : <span class="type">MviUiIntent &#123;</span></span></span><br><span class="line">    <span class="keyword">object</span> Add : CounterUiIntent()</span><br><span class="line">    <span class="keyword">object</span> Decrease : CounterUiIntent()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就是VM:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterViewModel</span></span>(initialState: CounterUiState) : BaseMviViewModel&lt;CounterUiState, CounterUiIntent&gt;(initialState) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleIntent</span><span class="params">(uiIntent: <span class="type">CounterUiIntent</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">when</span> (uiIntent) &#123;</span><br><span class="line">            <span class="keyword">is</span> CounterUiIntent.Add -&gt; &#123;</span><br><span class="line">                updateState &#123;</span><br><span class="line">                    copy(count = count + <span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">is</span> CounterUiIntent.Decrease -&gt; &#123;</span><br><span class="line">                updateState &#123;</span><br><span class="line">                    copy(count = count - <span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后是UI：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.easyliu.demo.mvi</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView</span><br><span class="line"><span class="keyword">import</span> androidx.activity.ComponentActivity</span><br><span class="line"><span class="keyword">import</span> androidx.lifecycle.ViewModel</span><br><span class="line"><span class="keyword">import</span> androidx.lifecycle.ViewModelLazy</span><br><span class="line"><span class="keyword">import</span> androidx.lifecycle.ViewModelProvider</span><br><span class="line"></span><br><span class="line"><span class="meta">@Suppress(<span class="meta-string">"UNCHECKED_CAST"</span>)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterMVIActivity</span> : <span class="type">ComponentActivity</span></span>(), MviView &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> counter: TextView</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> add: TextView</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> decrease: TextView</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> viewModel <span class="keyword">by</span> ViewModelLazy(CounterViewModel::<span class="class"><span class="keyword">class</span>,<span class="type"></span></span></span><br><span class="line">        &#123; viewModelStore &#125;, &#123;</span><br><span class="line">            <span class="keyword">object</span> : ViewModelProvider.Factory &#123;</span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : ViewModel&gt;</span> <span class="title">create</span><span class="params">(modelClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;)</span></span>: T &#123;</span><br><span class="line">                    <span class="keyword">if</span> (modelClass == CounterViewModel::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> CounterViewModel(CounterUiState(<span class="number">0</span>)) <span class="keyword">as</span> T</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">super</span>.create(modelClass)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.layout_counter_mvi)</span><br><span class="line">        counter = findViewById(R.id.tv_counter)</span><br><span class="line">        add = findViewById&lt;TextView?&gt;(R.id.bt_add).apply &#123;</span><br><span class="line">            setOnClickListener &#123;</span><br><span class="line">                viewModel.setIntent(CounterUiIntent.Add)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        decrease = findViewById&lt;TextView?&gt;(R.id.bt_decrease).apply &#123;</span><br><span class="line">            setOnClickListener &#123;</span><br><span class="line">                viewModel.setIntent(CounterUiIntent.Decrease)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        viewModel.onEach(CounterUiState::count) &#123;</span><br><span class="line">            counter.text = buildString &#123;</span><br><span class="line">                append(<span class="string">"计数:"</span>)</span><br><span class="line">                append(it)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，一个简单的计数功能就完成了，整体开发下来是不是很顺畅，遵循state -&gt; Intent -&gt; VM -&gt; View这样的一个开发流程</p>

        </div>
        <footer class="article-footer">
            



        </footer>
    </div>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "EasyLiu"
        },
        "headline": "MVI架构实践",
        "image": "http://easyliu.com/2023/08/13/android_architecture/mvi/counter.png",
        "keywords": "Android",
        "genre": "Android架构学习",
        "datePublished": "2023-08-13",
        "dateCreated": "2023-08-13",
        "dateModified": "2023-08-13",
        "url": "http://easyliu.com/2023/08/13/android_architecture/mvi/",
        "description": "1、为啥要用MVI架构为啥要从MVVM过渡到MVI，结合实际开发经验，个人总结以下几点：

1、从MVVM中的多个LiveData挨个观察改为一个State统一观察，当然如果我们需要观察State里面单独的某个字段，这个也是很方便做到的，下面的代码会讲到2、之前MVVM架构中，VM会开放很多方法给View调用；在MVI架构中，只有一个SendIntent入口，因此在一开始我们就可以把所有支持的的I",
        "wordCount": 3758
    }
</script>

</article>

    <section id="comments">
    
        
    <!-- Valine -->
    <div class="vcomments"></div>


    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/EasyLiu-Ly" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
    
        <a href="/2023/05/14/kotlin/kotlin_sam/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">kotlin接口支持SAM转换</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                
<div class="widget-wrap widget-list">
    <h3 class="widget-title">目录</h3>
    <div class="widget">
        <div id="toc" class="toc-article">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、为啥要用MVI架构"><span class="toc-number">1.</span> <span class="toc-text">1、为啥要用MVI架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、State"><span class="toc-number">2.</span> <span class="toc-text">2、State</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、Intent"><span class="toc-number">3.</span> <span class="toc-text">3、Intent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、BaseMviViewModel"><span class="toc-number">4.</span> <span class="toc-text">4、BaseMviViewModel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5、MviView"><span class="toc-number">5.</span> <span class="toc-text">5、MviView</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6、实践"><span class="toc-number">6.</span> <span class="toc-text">6、实践</span></a></li></ol>
        </div>
    </div>
</div>


            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2023/08/13/android_architecture/mvi/" class="thumbnail">
    
    
        <span style="background-image:url(/2023/08/13/android_architecture/mvi/counter.png)" alt="MVI架构实践" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Android架构学习/">Android架构学习</a></p>
                            <p class="item-title"><a href="/2023/08/13/android_architecture/mvi/" class="title">MVI架构实践</a></p>
                            <p class="item-date"><time datetime="2023-08-13T02:55:35.000Z" itemprop="datePublished">2023-08-13</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2023/05/14/kotlin/kotlin_sam/" class="thumbnail">
    
    
        <span style="background-image:url(/2023/05/14/kotlin/kotlin_sam/image.png)" alt="kotlin接口支持SAM转换" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Kotlin/">Kotlin</a></p>
                            <p class="item-title"><a href="/2023/05/14/kotlin/kotlin_sam/" class="title">kotlin接口支持SAM转换</a></p>
                            <p class="item-date"><time datetime="2023-05-14T15:49:01.000Z" itemprop="datePublished">2023-05-14</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2022/06/02/life/grow_tomato/" class="thumbnail">
    
    
        <span style="background-image:url(/2022/06/02/life/grow_tomato/week_two_half.jpeg)" alt="种植小番茄" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/园艺/">园艺</a></p>
                            <p class="item-title"><a href="/2022/06/02/life/grow_tomato/" class="title">种植小番茄</a></p>
                            <p class="item-date"><time datetime="2022-06-02T08:15:07.000Z" itemprop="datePublished">2022-06-02</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2022/05/22/life/grow_pepper/" class="thumbnail">
    
    
        <span style="background-image:url(/2022/05/22/life/grow_pepper/week_one.jpeg)" alt="种辣椒" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/园艺/">园艺</a></p>
                            <p class="item-title"><a href="/2022/05/22/life/grow_pepper/" class="title">种辣椒</a></p>
                            <p class="item-date"><time datetime="2022-05-22T08:01:07.000Z" itemprop="datePublished">2022-05-22</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2021/09/07/life/2021_8_22_seven_mother_moutain/" class="thumbnail">
    
    
        <span style="background-image:url(/2021/09/07/life/2021_8_22_seven_mother_moutain/pic_1.jpg)" alt="深圳大鹏7娘山——2021.8.22" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/周末活动/">周末活动</a></p>
                            <p class="item-title"><a href="/2021/09/07/life/2021_8_22_seven_mother_moutain/" class="title">深圳大鹏7娘山——2021.8.22</a></p>
                            <p class="item-date"><time datetime="2021-09-07T01:49:51.000Z" itemprop="datePublished">2021-09-07</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android性能优化/">Android性能优化</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android架构学习/">Android架构学习</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android源码解析/">Android源码解析</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android疑难杂症/">Android疑难杂症</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android自定义控件/">Android自定义控件</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Gradle相关/">Gradle相关</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/">Kotlin</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ios开发/">ios开发</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/从0打造音视频直播系统/">从0打造音视频直播系统</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/代码规范/">代码规范</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/刷题/">刷题</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/单元测试/">单元测试</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/周末活动/">周末活动</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/园艺/">园艺</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习计划/">学习计划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发工具/">开发工具</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/旅游/">旅游</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">八月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo进阶/">hexo进阶</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios开发/">ios开发</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/代码规范/">代码规范</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/单元测试/">单元测试</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习笔记/">学习笔记</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习计划/">学习计划</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日常活动/">日常活动</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日常生活/">日常生活</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">4</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="https://github.com/EasyLiu-Ly">我的github</a>
                    </li>
                
                    <li>
                        <a href="http://blog.csdn.net/liuyi1207164339">我的csdn博客</a>
                    </li>
                
                    <li>
                        <a href="http://blog.csdn.net/lmj623565791">鸿洋大神</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2023 EasyLiu</p>
                
                <p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="https://github.com/ppoffice" target="_blank">PPOffice</a></p>
                
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

    </div>
    
    
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
    <script>
        var GUEST = ['nick','mail','link'];
        var meta = 'undefined';
        meta = meta.split(',').filter(function (item) {
            return GUEST.indexOf(item)>-1;
        });
        var avatarcdn = 'https://gravatar.loli.net/avatar/' == true;
        new Valine({
            el: '.vcomments',
            notify: "false",
            verify: "false",
            appId: "HTT9HtdG3ACsrMQEd8X7aSD5-gzGzoHsz",
            appKey: "gEf913xnOAwiO8lVEWztLOQC",
            placeholder: "just write your comments",
            avatar:"retro",
            recordIP:"true",
            visitor: "true",
            emojiCDN: '//i0.hdslb.com/bfs/emote/', 
            emojiMaps: {
                "doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
                "亲亲": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
                "偷笑": "bb690d4107620f1c15cff29509db529a73aee261.png",
                "再见": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
                "冷漠": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
                "发怒": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
                "发财": "34db290afd2963723c6eb3c4560667db7253a21a.png",
                "可爱": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
                "吐血": "09dd16a7aa59b77baa1155d47484409624470c77.png",
                "呆": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
                "呕吐": "9f996894a39e282ccf5e66856af49483f81870f3.png",
                "困": "241ee304e44c0af029adceb294399391e4737ef2.png",
                "坏笑": "1f0b87f731a671079842116e0991c91c2c88645a.png",
                "大佬": "093c1e2c490161aca397afc45573c877cdead616.png",
                "大哭": "23269aeb35f99daee28dda129676f6e9ea87934f.png",
                "委屈": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
                "害羞": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
                "尴尬": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
                "微笑": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
                "思考": "90cf159733e558137ed20aa04d09964436f618a1.png",
                "惊吓": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png"
            }
        });
    </script>





    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    

    
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

</body>
</html>
